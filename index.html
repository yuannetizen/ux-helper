<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>UX 用户研究助手</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <!-- 读 Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- 读 Word -->
  <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
  <style>
    :root{--primary:#6366f1;--primary-dark:#4f46e5;--radius:12px;--shadow:0 8px 24px rgba(0,0,0,.08)}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px}
    .card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);max-width:720px;width:100%;padding:40px}
    h1{font-size:28px;font-weight:600;color:#1f2937;margin-bottom:8px}
    .subtitle{color:#6b7280;margin-bottom:28px;font-size:15px}
    label{font-weight:500;color:#374151;font-size:14px;margin-bottom:8px;display:block}
    #dataInput{width:100%;min-height:200px;resize:vertical;border:1px solid #d1d5db;border-radius:8px;padding:12px 16px;font-size:15px;transition:border .2s}
    #dataInput:focus{outline:none;border-color:var(--primary)}
    .upload-area{margin-top:12px;border:2px dashed #a5b4fc;border-radius:8px;padding:24px;text-align:center;color:#4f46e5;cursor:pointer;transition:background .2s}
    .upload-area:hover{background:#eef2ff}
    .btn{margin-top:24px;background:var(--primary);color:#fff;border:none;padding:12px 32px;font-size:16px;font-weight:500;border-radius:8px;cursor:pointer;transition:background .2s}
    .btn:hover{background:var(--primary-dark)}
    .btn:disabled{background:#9ca3af;cursor:not-allowed}
    .result{margin-top:32px;background:#f9fafb;border-left:4px solid var(--primary);padding:20px 24px;border-radius:0 8px 8px 0;white-space:pre-wrap;font-size:15px;line-height:1.6;color:#111827}
    .loading{display:inline-block;width:18px;height:18px;border:3px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin .6s linear infinite;margin-right:8px;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h1>UX 用户研究助手</h1>
    <p class="subtitle">粘贴问卷 / 访谈 / 行为数据，或拖拽上传 Excel（.xlsx）/ Word（.docx）文件，10 秒生成专业分析报告</p>

    <label for="dataInput">原始数据</label>
    <textarea id="dataInput" placeholder="支持 CSV、访谈文字、行为日志..."></textarea>

    <div class="upload-area" id="uploadArea">
      拖拽 Excel / Word 文件到此处 或 <strong>点击选择</strong>
      <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.docx,.doc" style="display:none">
    </div>

    <button id="analyzeBtn" class="btn" onclick="analyze()">生成分析</button>

    <div id="result" class="result" style="display:none;"></div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const dataInput = document.getElementById('dataInput');

    uploadArea.addEventListener('click', () => fileInput.click());

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
      uploadArea.addEventListener(evt, e => e.preventDefault(), false);
    });
    uploadArea.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      if (files.length) handleFile(files[0]);
    });

    fileInput.addEventListener('change', e => {
      if (e.target.files.length) handleFile(e.target.files[0]);
    });

    function handleFile(file) {
      const reader = new FileReader();
      const ext = file.name.split('.').pop().toLowerCase();

      if (['xlsx', 'xls', 'csv'].includes(ext)) {
        reader.onload = e => {
          const data = new Uint8Array(e.target.result);
          const wb = XLSX.read(data, { type: 'array' });
          const sheet = wb.Sheets[wb.SheetNames[0]];
          const csv = XLSX.utils.sheet_to_csv(sheet);
          dataInput.value = csv;
          uploadArea.textContent = '已加载 Excel：' + file.name;
        };
        reader.readAsArrayBuffer(file);
      } else if (['docx', 'doc'].includes(ext)) {
        reader.onload = e => {
          mammoth.extractRawText({ arrayBuffer: e.target.result })
            .then(res => {
              dataInput.value = res.value;
              uploadArea.textContent = '已加载 Word：' + file.name;
            })
            .catch(err => alert('Word 解析失败：' + err));
        };
        reader.readAsArrayBuffer(file);
      } else {
        alert('不支持的文件类型');
      }
    }

    async function analyze() {
      const btn = document.getElementById('analyzeBtn');
      const result = document.getElementById('result');
      const input = dataInput.value.trim();
      if (!input) return alert('请先输入或上传数据！');

      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>分析中...';
      result.style.display = 'none';

      const APP_ID = '45bdcd0e779b482692a54326bb51770d';
      const TOKEN = 'sk-4cae545893fc46099c18806ed421afcc';

      try {
        const res = await fetch('https://bailian-api.aliyuncs.com/v2/app/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': TOKEN },
          body: JSON.stringify({ app_id: APP_ID, prompt: input })
        });
        const data = await res.json();
        result.textContent = data.content || '分析完成';
      } catch (e) {
        result.textContent = '网络错误，请重试';
      } finally {
        btn.disabled = false;
        btn.textContent = '生成分析';
        result.style.display = 'block';
      }
    }
  </script>
</body>
</html>
